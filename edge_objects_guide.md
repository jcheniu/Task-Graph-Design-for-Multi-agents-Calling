# 05j v2 八类 Transition Objects（直观版）

基准：`05d_edge_reclassification_v2.csv`（当前 146 条边，含协议补全 E131-E146）。

---

## 1) 一眼看懂：8 类线段 = 8 种作用

| v2 类名 | 直观叫法 | 一句话作用 | 当前数量 |
|---|---|---|---:|
| `ProgressTransitionObject` | **前进线** | 把流程向前推进 | 42 |
| `GateTransitionObject` | **开关线** | 决定能不能过门（准入/放行） | 44 |
| `DecisionTransitionObject` | **选路线** | 多条可行路径中做选择 | 13 |
| `ExceptionTransitionObject` | **异常线** | 出错后阻断、绕行、升级 | 12 |
| `LoopTransitionObject` | **复跑线** | 当前环节再来一次（重试/返修） | 10 |
| `RollbackTransitionObject` | **回退线** | 退回上游阶段重做 | 9 |
| `SyncTransitionObject` | **对齐线** | 依赖绑定、并行汇合、状态同步 | 7 |
| `MetaTransitionObject` | **说明线** | 注释、治理记录、建议入口 | 9 |

---

## 2) 八类详细说明

## 2.1 `ProgressTransitionObject`（前进线）

**它是什么**
- 流程“继续往前走”的线。
- 通常是正向推进（forward, positive）。

**什么时候用**
- A 阶段结束后进入 B 阶段。
- 检查通过后放行到下一状态。

**代表边**
- `E001 P0->P01`
- `E141 ARTIFACT_CHECK->P55`

---

## 2.2 `GateTransitionObject`（开关线）

**它是什么**
- 控制“能不能进入下一步”的门。
- 只负责“过门”，不负责“选哪条路”。

**什么时候用**
- 进入某阶段前必须过检查。
- 每阶段后触发全局 gate（如时间门）。

**代表边**
- `E030 TG->TV`
- `E069 P65->APC`
- `E131 TG->TV_CALL`

---

## 2.3 `DecisionTransitionObject`（选路线）

**它是什么**
- 多方案之间做选择的线。
- 核心是路径选择，不是准入控制。

**什么时候用**
- 接受/拒绝建议。
- 分派并行/串行/混合路线。

**代表边**
- `E048 DM->PAUSE`
- `E049 DM->TG`
- `E058 D5->I5`

---

## 2.4 `ExceptionTransitionObject`（异常线）【重点说明】

**一句话理解**
- 当“正常流程走不下去”时，异常线定义系统怎么处理失败：**拦住、绕开、升级**。

**它具体负责什么**
1. **阻断（block）**：条件不满足，禁止继续。
2. **旁路（bypass）**：主路径失效时，切到应急路径。
3. **升级（escalation）**：问题累计到阈值后，进入更强处理策略。

**你可以把它看成**
- “故障处理通道”。
- 和前进线互补：前进线讲“顺利时怎么走”，异常线讲“失败时怎么活下去”。

**何时必须用异常线**
- 有明确失败阈值（如超时 3 次、编译持续失败）。
- 有禁止动作（如 file-ban、安全/权限阻断）。
- 有应急流程（如 bypass director 的 emergency chain）。

**不该用异常线的情况**
- 正常准入判断（那是开关线）。
- 正常策略选择（那是选路线）。
- 只是重复尝试同一步（那是复跑线）。

**代表边**
- `E028 TG->RR`（未过时间门，阻断）
- `E066 EM->BP`（收敛失败，走旁路）
- `E134 TIMEOUT3->ALT`（3x timeout 升级）
- `E144 DIRECTOR->FILE_BAN`（权限阻断）

---

## 2.5 `LoopTransitionObject`（复跑线）

**它是什么**
- 当前环节“再做一轮”的循环线。

**什么时候用**
- retry/rerun/revision/fix。

**代表边**
- `E029 RR->TG`
- `E082 RET->CMP`
- `E132 RR->RERUN_CMD`

---

## 2.6 `RollbackTransitionObject`（回退线）

**它是什么**
- 明确回到更早阶段重做的线。

**什么时候用**
- REQUIRE_REWIND 后退回上游 phase。

**代表边**
- `E036 VR->PAUSE`
- `E038 PAUSE->RW1`
- `E041 RW5->RESUME`

---

## 2.7 `SyncTransitionObject`（对齐线）【重点说明】

**一句话理解**
- 对齐线不是“推进流程”，而是定义“谁依赖谁、什么时候才能继续”。

**它具体负责什么**
1. **依赖锁（dependency）**：上游没完成，下游不能开始。
2. **汇合点（join）**：并行分支必须全部到齐，才能合流。
3. **状态一致（state sync）**：下一步必须读取/更新指定状态文件或产物。

**你可以把它看成**
- “并发与依赖的交通规则”。
- 没有它，流程图会看起来能跑，但执行时会出现先后错乱、读到旧数据、提前放行。

**何时必须用对齐线**
- 存在显式前置条件（A done 才能 B）。
- 多 worker 并行后要统一汇总。
- rerun 需要读取 previous output。
- 关键产物/manifest 更新是后续步骤前置条件。

**不该用对齐线的情况**
- 只是“过门检查”（那是开关线）。
- 只是“继续前进”（那是前进线）。

**代表边**
- `E034 P01->B01`、`E035 B01->P02`（依赖锁）
- `E061 I5->W5`、`E063 M5->W5`（并行汇合）
- `E133 RERUN_CMD->PREV_OUT`（读取 previous_output）
- `E139 P7F->MANIFEST7`（状态文件更新依赖）

---

## 2.8 `MetaTransitionObject`（说明线）【重点说明】

**一句话理解**
- 说明线用于表达“治理与语义信息”，通常不直接触发执行动作。

**它具体负责什么**
1. **注释连接（annotation）**：把说明节点与流程节点关联，保留语义背景。
2. **治理记录（governance trace）**：把问题记录、来源说明等信息挂到流程上。
3. **建议入口（ingress）**：把各 agent 的建议统一接入决策入口。

**你可以把它看成**
- “流程图的可解释层”。
- 没有说明线，流程仍能执行，但会丢失“为什么这样做、建议从哪来、记录在哪里”的上下文。

**何时必须用说明线**
- 需要把文字说明和流程节点绑定。
- 需要把治理动作（如 known_issues）显式纳入协议。
- 需要表达多来源建议进入同一决策口。

**不该用说明线的情况**
- 这条边本身会改变执行状态（应归前进/开关/异常等可执行类）。

**代表边**
- `E130 NOTE->P0`（说明连线）
- `E050 CT->SUG`（建议入口）
- `E137 ANY_PHASE->KNOWN_ISSUES`（治理记录）

---

## 3) 最容易混淆的边界

### A. 开关线 vs 选路线
- 开关线：能不能过门。
- 选路线：过门后走哪条分支。

### B. 复跑线 vs 回退线
- 复跑线：当前附近再试。
- 回退线：回到上游 phase。

### C. 开关失败 vs 异常线
- 开关线是规则本体。
- 异常线是规则失败后的处理通道。

### D. 对齐线 vs 前进线
- 前进线：让流程继续。
- 对齐线：定义“现在能不能继续”。

### E. 说明线 vs 可执行线
- 说明线：解释/治理语义。
- 可执行线：直接改变流程状态。

---

## 4) 快速判别（10 秒）

1. 是让流程向前走吗？→ **前进线**
2. 是过门准入吗？→ **开关线**
3. 是多路径选择吗？→ **选路线**
4. 是失败后的阻断/绕行/升级吗？→ **异常线**
5. 是当前步骤重试吗？→ **复跑线**
6. 是退回上游阶段吗？→ **回退线**
7. 是依赖/汇合/状态同步吗？→ **对齐线**
8. 是注释/治理/建议入口吗？→ **说明线**

---

## 5) 备注

- 12 项协议缺口已全部映射到 E131-E146（见 `05i_logic_gaps_not_covered_by_130_edges.md`）。
- 当前总边数 146，含恢复的原始 `E130 NOTE->P0`。
